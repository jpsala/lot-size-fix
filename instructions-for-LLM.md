# Project Summary: lot-size-fix

This document provides a comprehensive overview of the "lot-size-fix" project, designed to serve as a knowledge base for future AI assistants.

## 1. Project Overview

The `lot-size-fix` is a Go application specifically developed to patch `.mq5` files that are generated by StrategyQuant X. Its primary purpose is to correct critical issues within these automatically generated trading scripts.

## 2. The Problem

The core issue addressed by this tool stems from an incorrect lot size calculation within the `sqMMFixedAmount` function in the StrategyQuant X generated `.mq5` files. This function utilizes a faulty `PointValue` calculation, which can lead to inaccurate trade sizing and, consequently, trade failures in live trading environments.

## 3. The Fix

The application applies two main patches to resolve the identified issues:

*   **`SQMMFixedAmount` Patch:**
    *   Replaces the problematic `PointValue` logic with a more reliable `OrderCalcProfit` method to ensure accurate lot size calculations.
    *   Sets the `UseSQTickSize` variable to `true` to align with correct tick size handling.
    *   Updates the `MagicNumber` within the function, which is crucial for identifying and managing trades initiated by the expert advisor.

*   **`LotSizeLogging` Patch:**
    *   Adds extensive `PrintFormat` logging statements to the `sqMMFixedAmount` function. This enhanced logging is vital for debugging lot size calculations, providing detailed insights into the values and logic at various stages of the calculation, which helps in diagnosing and preventing future issues.

## 4. Project Components

The key files and their purposes within the `lot-size-fix` project are:

*   [`main.go`](main.go): The entry point of the Go application, orchestrating the patching process.
*   [`core/patcher.go`](core/patcher.go): Contains the core logic for reading, parsing, modifying, and writing the `.mq5` files. This is where the actual patching operations are implemented.
*   [`core/logging_patch.go`](core/logging_patch.go): Specifically handles the insertion of logging statements into the `.mq5` files.
*   [`install.ps1`](install.ps1): A PowerShell script used for installing the application and setting up necessary environment configurations.
*   `.mq5` scripts: These are the StrategyQuant X generated files that the application processes and patches. Examples include `partialScript.mq5`.
*   [`gui/gui.go`](gui/gui.go): Contains the code for the graphical user interface, if applicable.
*   [`logger/logger.go`](logger/logger.go): Provides logging utilities for the Go application itself.

## 5. User's Issue Context

It is important to note that the user has reported a "Trade disabled" error on their Virtual Private Server (VPS). This specific error is identified as an MT5 (MetaTrader 5) environment/configuration issue, and **not** a script/code issue that this `lot-size-fix` tool is designed to address. The tool focuses solely on correcting lot size calculation logic within the `.mq5` scripts.

## 6. Sample File Clarification

The file `partialScript.mq5` is an incomplete sample file. It was provided solely for analysis and testing purposes during the development and debugging of the `lot-size-fix` application. The user's actual trading scripts have already been processed and patched by the application.